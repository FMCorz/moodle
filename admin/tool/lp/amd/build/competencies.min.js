define(["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/competencyselector","tool_lp/dragdrop-reorder"],function(a,b,c,d,e,f,g){var h=function(c,e,g){this.itemid=c,this.itemtype=e,this.pageContextId=g;var h=this,i=null,j=null,k=null;"course"===e?(i=[{methodname:"tool_lp_add_competency_to_course",args:{courseid:this.itemid}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:this.itemid}}],j="tool_lp/course_competencies_page",k="coursecompetenciespage"):"template"===e&&(i=[{methodname:"tool_lp_add_competency_to_template",args:{templateid:this.itemid}},{methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:this.itemid}}],j="tool_lp/template_competencies_page",k="templatecompetenciespage");var l=f.init();l.done(function(c){return 0===c.length?void d.render("tool_lp/no_frameworks_warning",{}).done(function(b){a('[data-region="actions"]').append(b),a('[data-region="actions"] button').hide()}).fail(b.exception):(a('[data-region="actions"] button').show(),h.registerEvents(),h.registerDragDrop(),void f.setAddCompetencyRequests(i,j,k))}).fail(b.exception)};return h.prototype.registerDragDrop=function(){var a=this;e.get_string("movecompetency","tool_lp").done(function(b){g.dragdrop("movecompetency",b,{identifier:"movecompetency",component:"tool_lp"},{identifier:"movecompetencyafter",component:"tool_lp"},"drag-samenode","drag-parentnode","drag-handlecontainer",function(b,c){a.handleDrop.call(a,b,c)})}).fail(b.exception)},h.prototype.handleDrop=function(d,e){var f=a(d).data("id"),g=a(e).data("id"),h=this,i=[];if("course"==h.itemtype)i=c.call([{methodname:"tool_lp_reorder_course_competency",args:{courseid:h.itemid,competencyidfrom:f,competencyidto:g}}]);else{if("template"!=h.itemtype)return null;i=c.call([{methodname:"tool_lp_reorder_template_competency",args:{templateid:h.itemid,competencyidfrom:f,competencyidto:g}}])}i[0].fail(b.exception)},h.prototype.registerEvents=function(){var e=this;a('[data-region="actions"] button').click(function(a){return f.openCompetencySelector()}),a('[data-action="delete-competency-link"]').click(function(f){var g=[],h="",i="";f.preventDefault();var j=a(f.target).closest("[data-id]").data("id");"course"==e.itemtype?(g=c.call([{methodname:"tool_lp_remove_competency_from_course",args:{courseid:e.itemid,competencyid:j}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:e.itemid}}]),h="tool_lp/course_competencies_page",i="coursecompetenciespage"):"template"==e.itemtype&&(g=c.call([{methodname:"tool_lp_remove_competency_from_template",args:{templateid:e.itemid,competencyid:j}},{methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:e.itemid,pagecontext:{contextid:e.pageContextId}}}]),h="tool_lp/template_competencies_page",i="templatecompetenciespage"),g[1].done(function(c){d.render(h,c).done(function(b,c){a('[data-region="'+i+'"]').replaceWith(b),d.runTemplateJS(c)}).fail(b.exception)}).fail(b.exception)})},h});