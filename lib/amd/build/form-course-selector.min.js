define(["core/ajax","jquery"],function(a,b){return{processResults:function(a,c){var d=[],e=0,f=String(b(a).data("exclude")).split(",");for(e=0;e<c.courses.length;e++)-1===f.indexOf(String(c.courses[e].id))&&d.push({value:c.courses[e].id,label:c.courses[e].displayname});return d},transport:function(c,d,e,f){var g,h,i,j,k=b(c),l=k.data("requiredcapabilities");l=""!==l.trim()?l.split(","):[];var m=k.data("limittoenrolled"),n=null;"undefined"==typeof d&&(d="");var o=k.data("includefrontpage");o&&(g=k.data("frontpageid")||"",h=k.data("frontpagefullname")||"",i=k.data("frontpageshortname")||"",j=k.data("frontpagedisplayname")||"",o=""===d||h.toUpperCase().indexOf(d.toUpperCase())>-1||i.toUpperCase().indexOf(d.toUpperCase())>-1);var p={criterianame:"search",criteriavalue:d,page:0,perpage:100,requiredcapabilities:l,limittoenrolled:m};return n=a.call([{methodname:"core_course_search_courses",args:p}]),n[0].done(function(a){o&&a.courses.splice(0,0,{id:g,displayname:j}),e(a)}),n[0].fail(f),n}}});