define(["jquery","core/config"],function(a,b){var c=50,d=3*c,e="core/amd:scheduled-pending",f=[],g=null,h=0,i=function(a){var b,c,d=this,e=null,f=0;for(f=0;f<d.length;f++){if(b=d[f],c=a[f],"undefined"==typeof c){e=new Error("missing response");break}if(c.error!==!1){e=c.exception;break}b.deferred.resolve(c.data)}if(null!==e)for(;f<d.length;f++)b=d[f],b.deferred.reject(e)},j=function(a,b){var c=this,d=0;for(d=0;d<c.length;d++){var e=c[d];"undefined"!=typeof e.data.fail&&e.deferred.reject(b)}},k=function(b,c){var d=a.Deferred();return"undefined"!=typeof b.done&&d.done(b.done),"undefined"!=typeof b.fail&&d.fail(b.fail),{data:b,loginRequired:c,deferred:d}},l=function(c,d,e){var f=b.wwwroot+"/lib/ajax/service.php?sesskey="+b.sesskey;e||(f=b.wwwroot+"/lib/ajax/service-nologin.php?sesskey="+b.sesskey);var g={type:"POST",data:JSON.stringify(c.map(function(a,b){return{index:b,methodname:a.data.methodname,args:a.data.args}})),context:c,dataType:"json",processData:!1,async:d,contentType:"application/json"};d?a.ajax(f,g).then(i).fail(j):(g.success=i,g.error=j,a.ajax(f,g))},m=function(){var a=f.slice();f=[],h=0,g=null;var b=a.reduce(function(a,b){return a||b.loginRequired},!1);l(a,!0,b),M.util.js_complete(e)},n=function(b){a.each(b,function(a,b){f.push(b)}),h<d&&(null===g&&M.util.js_pending(e),clearTimeout(g),h+=c,g=setTimeout(m,c,!0))};return{call:function(a,b,c){"undefined"==typeof c&&(c=!0),"undefined"==typeof b&&(b=!0);var d=a.map(function(a){return k(a,c)});return b?n(d):l(d,b,c),d.map(function(a){return a.deferred.promise()})}}});